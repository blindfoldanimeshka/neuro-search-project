# Настройка LM Studio для локального AI

## Что было сделано

1. **Модифицирован API route `/api/ai/route.ts`**:
   - Добавлена поддержка LM Studio наряду с OpenRouter
   - Автоматическое определение типа модели (локальная или облачная)
   - Проверка доступности LM Studio перед запросом

2. **Обновлен файл `.env.local`**:
   - Добавлена переменная `DEFAULT_AI_MODEL=qwen/qwen3-4b`
   - Настроен базовый URL для LM Studio: `http://127.0.0.1:1234`

3. **Создан тестовый компонент**:
   - `LMStudioTestButton` для проверки подключения
   - Отображается в правом верхнем углу приложения

## Как настроить LM Studio

### Шаг 1: Установка LM Studio
1. Скачайте LM Studio с [официального сайта](https://lmstudio.ai/)
2. Установите программу на ваш компьютер

### Шаг 2: Загрузка модели
1. Откройте LM Studio
2. Перейдите в раздел "Browse" или "Models"
3. Найдите и загрузите модель `Qwen 3 4B` (или любую другую)
4. Дождитесь завершения загрузки

### Шаг 3: Запуск локального сервера
1. В LM Studio перейдите в раздел "Local Server"
2. Выберите загруженную модель
3. Нажмите "Start Server"
4. Убедитесь, что сервер запущен на порту `1234`

### Шаг 4: Проверка подключения
1. Откройте приложение в браузере
2. В правом верхнем углу найдите кнопку "Протестировать LM Studio"
3. Нажмите на кнопку для проверки подключения

## Поддерживаемые модели

Система автоматически определяет локальные модели по следующим критериям:
- Модель содержит `lmstudio` в названии
- Модель содержит `local` в названии
- Модель точно соответствует `qwen/qwen3-4b`

## Переключение между провайдерами

1. **Для использования LM Studio**:
   - Выберите модель с типом `lmstudio` в селекторе моделей
   - Или установите `DEFAULT_AI_MODEL=qwen/qwen3-4b` в `.env.local`

2. **Для использования OpenRouter**:
   - Добавьте валидный API ключ в `.env.local`
   - Выберите модель OpenRouter в селекторе

## Решение проблем

### LM Studio недоступен
- Убедитесь, что LM Studio запущен
- Проверьте, что сервер работает на порту 1234
- Попробуйте открыть http://127.0.0.1:1234 в браузере

### Модель не найдена
- Убедитесь, что модель загружена в LM Studio
- Проверьте, что модель выбрана в настройках сервера
- Перезапустите сервер LM Studio

### Ошибка подключения
- Проверьте файрвол и антивирус
- Убедитесь, что порт 1234 не занят другим приложением
- Попробуйте перезапустить LM Studio